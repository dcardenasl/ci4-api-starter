# Internacionalización (i18n)

## Propósito
Definir reglas i18n estrictas y reutilizables para este template, de modo que nuevos CRUD/componentes mantengan consistencia en archivos y uso de claves.

## Estructura de Archivos de Idioma

```
app/Language/
├── en/
│   ├── Api.php
│   ├── Auth.php
│   ├── Email.php
│   ├── InputValidation.php
│   ├── Users.php
│   ├── ApiKeys.php
│   └── ...
└── es/
    └── (mismos archivos y mismo árbol de claves)
```

## Convención de Nombres para Nuevos CRUD
- Usar `Plural PascalCase` para archivos de dominio.
- Ejemplo: `Products.php`, `Orders.php`, `Invoices.php`.
- Usar claves como `Products.notFound`, `Orders.createdSuccess`.

## Reglas de Uso de Claves por Capa
- `Services`:
  - Usar claves de dominio (`Products.*`, `Users.*`) para mensajes de negocio.
  - Usar `Api.*` solo para mensajes genéricos de transporte (`invalidRequest`, `validationFailed`, etc.).
- `Models`:
  - Los mensajes de validación deben usar únicamente `InputValidation.*`.
- `Validation classes` (`app/Validations/*`):
  - Usar únicamente `InputValidation.*`.
- `Email templates/services`:
  - Usar claves `Email.*`.

## Alcance: Qué Debe Internacionalizarse
Debe usar `lang()`:
- Mensajes de respuesta API.
- Mensajes de excepciones retornables al cliente API.
- Mensajes de validación.

Puede permanecer técnico/no localizado:
- Logs internos (`log_message`).
- Excepciones internas de infraestructura/configuración (no user-facing).

## Detección de Locale
Orden de prioridad:
1. Header `Accept-Language`.
2. `defaultLocale` en `app/Config/App.php`.

## Guardrails (Obligatorio)
Ejecutar:

```bash
composer i18n-check
```

El check valida:
- Paridad de archivos entre `en/` y `es/`.
- Paridad de claves entre idiomas.
- Que toda clave referenciada con `lang('Archivo.key')` exista en ambos idiomas.
- Que mensajes de validación en models usen `InputValidation.*`.
- Detección básica de mensajes hardcodeados user-facing en excepciones.

## Checklist Obligatorio para Nuevos CRUD/Componentes
1. Crear `app/Language/en/{ResourcePlural}.php`.
2. Crear `app/Language/es/{ResourcePlural}.php` con las mismas claves.
3. Agregar claves de validación en `InputValidation.php` (`en` y `es`).
4. Usar claves de dominio en services y `InputValidation.*` en validación de models.
5. Ejecutar `composer i18n-check` y tests antes del PR.
